<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập</title>
</head>
<body>
    <h2>Đăng nhập Hệ thống</h2>
    <form id="loginForm">
        <div>
            <label for="username">Tên đăng nhập:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div>
            <label for="password">Mật khẩu:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div>
            <input type="checkbox" id="remember" name="remember">
            <label for="remember">Ghi nhớ đăng nhập</label>
        </div>
        <button type="submit">Đăng nhập</button>
        <p id="message" style="color: red;"></p>
    </form>
    
    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginForm = document.getElementById('loginForm');
            const message = document.getElementById('message');

            // Kiểm tra nếu đã có session hợp lệ thì chuyển hướng luôn
            validateAndRedirect(null, '/dashboard.html'); 
            
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                message.textContent = 'Đang xử lý...';

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const remember = document.getElementById('remember').checked;

                const result = await handleLogin(username, password, remember);

                if (result.success) {
                    message.textContent = 'Đăng nhập thành công! Đang chuyển hướng...';
                    window.location.href = '/dashboard.html'; // Chuyển hướng đến dashboard
                } else {
                    message.textContent = result.message || 'Lỗi đăng nhập không xác định.';
                }
            });
        });
    </script>
</body>
</html>
