<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thông tin cá nhân</title>
</head>
<body>
    <header>
        <h1>Thông tin cá nhân</h1>
        <nav>
            <a href="/dashboard.html">Dashboard</a> | 
            <a href="/profile.html">Thông tin cá nhân</a> | 
            <button id="logoutBtn">Đăng xuất</button>
        </nav>
    </header>
    <main id="profileInfo">
        <p>Đang tải thông tin...</p>
    </main>

    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Kiểm tra session
            validateAndRedirect('/login.html')
                .then(session => {
                    if (session.isAuthenticated) {
                        // 2. Session hợp lệ -> Lấy thông tin người dùng
                        loadUserProfile();
                    } else {
                        document.getElementById('profileInfo').innerHTML = `<p>Bạn cần đăng nhập để xem trang này.</p>`;
                    }
                });

            async function loadUserProfile() {
                const profileInfoDiv = document.getElementById('profileInfo');
                const result = await getUserInfo();

                if (result.success && result.user) {
                    const user = result.user;
                    profileInfoDiv.innerHTML = `
                        <table>
                            <tr><th>Tên đăng nhập:</th><td>${user.username}</td></tr>
                            <tr><th>Email:</th><td>${user.email}</td></tr>
                            <tr><th>Họ tên:</th><td>${user.name || '(Chưa cập nhật)'}</td></tr>
                            <tr><th>Nhóm người dùng:</th><td>${user.user_group}</td></tr>
                            <tr><th>Trạng thái:</th><td>${user.user_status}</td></tr>
                            <tr><th>Ngày tạo:</th><td>${user.created_at || '(Không rõ)'}</td></tr>
                        </table>
                        <p style="margin-top: 20px;">*Lưu ý: Mật khẩu đã được loại bỏ khi truy vấn.</p>
                    `;
                } else {
                    profileInfoDiv.innerHTML = `<p style="color: red;">Lỗi: ${result.message || 'Không thể tải thông tin người dùng.'}</p>`;
                }
            }

            // Gán sự kiện cho nút đăng xuất
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        });
    </script>
</body>
</html>
